# Лабораторная работа № 07

## Тема: Асинхронное программирование

## Описание

Многопоточная симуляция NPC на карте размером 100x100. Программа моделирует движение и боевые взаимодействия между различными типами NPC с использованием трех параллельных потоков.

## Требования

1. **Три потока:**
   - **Movement Thread**: Движение NPC на указанное расстояние, определение боевых ситуаций
   - **Combat Thread**: Обработка боев с использованием кубика (6-гранный)
   - **Main Thread**: Печать карты раз в секунду

2. **3 типа NPC** (из лабы 6, адаптированные под требования лабы 7):
   - Bear (Медведь) - расстояние хода: 5, расстояние убийства: 10
   - Elf (Эльф) - расстояние хода: 10, расстояние убийства: 50
   - Robber (Разбойник) - расстояние хода: 10, расстояние убийства: 10

3. **Синхронизация:**
   - `std::shared_lock` и `std::lock_guard` для доступа к общим ресурсам
   - `std::lock_guard` для контроля `std::cout`

4. **Инициализация:**
   - 50 NPC в случайных местах при старте

5. **Завершение:**
   - Игра останавливается через 30 секунд
   - Вывод списка выживших NPC

## Структура проекта

```
lab_7/
├── include/          # Заголовочные файлы
│   ├── npc.hpp       # Базовый класс NPC
│   ├── game.hpp      # Класс Game с потоками
│   ├── npc_factory.hpp
│   └── ...           # Заголовки для всех типов NPC
├── src/              # Исходные файлы
│   ├── main.cpp      # Точка входа
│   ├── game.cpp      # Реализация игры
│   └── ...           # Реализации всех типов NPC
├── tests/            # Тесты
├── CMakeLists.txt    # Файл сборки
└── README.md         # Этот файл
```

## Сборка

### Linux/macOS

```bash
mkdir build
cd build
cmake ..
cmake --build .
```

### Windows (PowerShell)

```powershell
mkdir build
cd build
cmake ..
cmake --build .
```

### Windows (Visual Studio)

```powershell
mkdir build
cd build
cmake .. -G "Visual Studio 17 2022"
cmake --build . --config Release
```

## Запуск

### Linux/macOS

```bash
cd build
./lab7_main
```

### Windows

```powershell
cd build
.\lab7_main.exe
```

## Тестирование

Для запуска тестов необходимо раскомментировать соответствующие строки в `CMakeLists.txt` и добавить тестовые файлы в директорию `tests/`.

### Добавление тестов

1. Раскомментируйте блок тестов в `CMakeLists.txt`:
```cmake
add_executable(lab7_tests
    tests/test_npc.cpp
)

target_link_libraries(lab7_tests
    npc_lib
    gtest_main
    gtest
)

include(GoogleTest)
gtest_discover_tests(lab7_tests)
```

2. Создайте тестовые файлы в директории `tests/`

3. Пересоберите проект:
```bash
cd build
cmake ..
cmake --build .
```

### Запуск тестов

```bash
cd build
ctest
# или
ctest --verbose
```

### Запуск конкретного теста

```bash
cd build
./lab7_tests
```

## Особенности реализации

- **Потокобезопасность**: Использование `std::shared_mutex` для чтения и `std::unique_lock` для записи
- **Синхронизация вывода**: Все операции с `std::cout` защищены `std::lock_guard`
- **Очередь боев**: Использование `std::condition_variable` для эффективной обработки боевых задач
- **Visitor Pattern**: Использован для реализации боевой логики
- **Factory Pattern**: Использован для создания NPC различных типов

## Таблица убиваемости

Каждый тип NPC имеет:
- **Расстояние хода**: На какое расстояние может переместиться за один ход
- **Расстояние убийства**: На каком расстоянии может атаковать противника

Детали смотрите в `include/npc_types.hpp`.

## Примечания

- Мертвые NPC не двигаются
- NPC не могут покинуть границы карты (0-100)
- Бой происходит с использованием 6-гранного кубика
- Игра автоматически завершается через 30 секунд
